var e=Object.defineProperty,a=Object.defineProperties,n=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,c=(a,n,t)=>n in a?e(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;import{d as r,r as l,aA as u,b as i,c as f,w as d,ah as b,k as g,e as p,f as h,t as v,u as y,v as m,G as T,aj as x,ak as w,i as O,_}from"./index-6e705c16.js";const j=r({name:"sign"}),k=r((P=((e,a)=>{for(var n in a||(a={}))s.call(a,n)&&c(e,n,a[n]);if(t)for(var n of t(a))o.call(a,n)&&c(e,n,a[n]);return e})({},j),a(P,n({setup(e){const a=l(!1),n=l(!1);let t=null,s=!1,o=[],c=[];function r(){t=b("canvas"),t.lineWidth=4,t.lineCap="round",t.lineJoin="round"}function _(e){const a=o[0],s=o[1];e||c[c.length-1].push(JSON.parse(JSON.stringify(o))),o.shift(),t.moveTo(a.X,a.Y),t.lineTo(s.X,s.Y),t.stroke(),t.draw(!0),n.value=!0}function j(){c.push([]),t.beginPath(),s=!0}function k(e){if(s){let a={};a=e.changedTouches[0].x?{X:e.changedTouches[0].x,Y:e.changedTouches[0].y}:{X:e.changedTouches[0].pageX-e.currentTarget.offsetLeft,Y:e.changedTouches[0].pageY-e.currentTarget.offsetTop},o.push(a),o.length>=2&&_()}}function P(){c=c.filter((e=>e.length>0)),o=[],s=!1}function C(e){e&&(c=[]),t.clearRect(0,0,1e3,1e3),t.draw(!0),n.value=!1}function J(){C(!0),a.value=!a.value;const e=setTimeout((()=>{r(),clearTimeout(e)}),100)}function S(){if(C(),c.length<=1)return c=[],void(o=[]);c.pop(),c.forEach((e=>{e.forEach((e=>{o=JSON.parse(JSON.stringify(e)),_(1)}))}))}const X=()=>{n.value?x({canvasId:"canvas",success:e=>{const{tempFilePath:a}=e;!function(e,a){const n=new Image;n.src=e;const t=document.createElement("a");t.download=a||"canvas-image",t.href=n.src,t.click()}(a,`sign-${(new Date).getTime()}`)},fail:()=>{T({title:"转换图片失败",icon:"none"})}}):T({title:"请签名",icon:"none"})};return u((()=>{r()})),(e,n)=>{const t=w,s=O,o=g("layout-default-uni");return i(),f(o,null,{default:d((()=>[p(s,{class:m(["canvas-box flex flex-col box-border p-3",{"full-screen":y(a)}])},{default:d((()=>[p(t,{"canvas-id":"canvas",class:"w-full b b-dashed b-rd b-gray-300 canvas","disable-scroll":!0,onTouchstart:j,onTouchmove:k,onTouchend:P,onMousedown:j,onMousemove:k,onMouseup:P}),p(s,{class:"btns flex justify-between text-center box-border"},{default:d((()=>[p(s,{class:"btn-box flex"},{default:d((()=>[p(s,{class:"btn bg-gray-100 b-rd b-gray-300 c-gray-500 p-1",onClick:J},{default:d((()=>[h(v(y(a)?"退出全屏":"全屏"),1)])),_:1}),p(s,{class:"btn bg-gray-100 b-rd b-gray-300 c-gray-500 p-1 ml-2",onClick:C},{default:d((()=>[h("清空")])),_:1}),p(s,{class:"btn bg-gray-100 b-rd b-gray-300 c-gray-500 p-1 ml-2",onClick:S},{default:d((()=>[h(" 撤回 ")])),_:1})])),_:1}),p(s,{class:"btn-box flex"},{default:d((()=>[p(s,{class:"btn bg-sky-500 b-rd c-white p-1",onClick:X},{default:d((()=>[h("保存")])),_:1})])),_:1})])),_:1})])),_:1},8,["class"])])),_:1})}}}))));var P;const C=_(k,[["__scopeId","data-v-52f0da0d"]]);export{C as default};
